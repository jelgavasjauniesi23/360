<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>360° Virtual Tour</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script>
        // Wait for A-Frame to be ready before registering components
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof AFRAME !== 'undefined') {
                // Register cursor-listener component
                AFRAME.registerComponent('cursor-listener', {
                    init: function () {
                        this.el.addEventListener('click', function (evt) {
                            console.log('Hotspot clicked!');
                        });
                    }
                });
            }
        });
    </script>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <h1>360° Virtual Tour</h1>
            <div class="controls">
                <button id="devModeBtn" class="btn btn-secondary">Dev Mode</button>
            </div>
        </header>

        <!-- Folder Navigation -->
        <nav class="folder-nav">
            <h3>Select Tour:</h3>
            <div class="folder-list">
                <button class="folder-btn active" data-folder="pakapiens">Pakapiens</button>
                <button class="folder-btn" data-folder="pietura">Pietura</button>
                <button class="folder-btn" data-folder="spaktele">Spaktele</button>
            </div>
        </nav>

        <!-- Main Viewer -->
        <div id="viewer-container">
            <a-scene id="aframe-scene" 
                     vr-mode-ui="enabled: true" 
                     embedded 
                     style="height: 100%; width: 100%;"
                     background="color: #000"
                     loading-screen="dotsColor: #667eea; backgroundColor: #000">
                
                <!-- 360° Image Sphere -->
                <a-sky id="sky-sphere" 
                       radius="500" 
                       src="" 
                       rotation="0 -130 0">
                </a-sky>
                
                <!-- Camera with look controls -->
                <a-camera id="main-camera" 
                          look-controls="enabled: true; pointerLockEnabled: true"
                          wasd-controls="enabled: false"
                          cursor="rayOrigin: mouse"
                          raycaster="objects: [data-raycastable]">
                </a-camera>
                
            <!-- Hotspots will be added here dynamically -->
            <div id="hotspot-container"></div>
            
            <!-- Reticle for hotspot placement -->
            <div id="reticle" class="reticle hidden">
                <div class="reticle-crosshair">
                    <div class="reticle-line horizontal"></div>
                    <div class="reticle-line vertical"></div>
                    <div class="reticle-center"></div>
                </div>
                <div class="reticle-text">Click to place hotspot</div>
            </div>
                
            </a-scene>
            
            <!-- Navigation Controls -->
            <div class="navigation-controls">
                <button id="prev-image" class="nav-btn prev-btn" title="Previous Image">‹</button>
                <button id="next-image" class="nav-btn next-btn" title="Next Image">›</button>
                <div class="image-counter">
                    <span id="current-image-num">1</span> / <span id="total-images">0</span>
                </div>
            </div>
            
            <!-- Dev Mode Controls -->
            <div id="dev-controls" class="dev-controls hidden">
                <h4>Dev Mode - Add Hotspots</h4>
                <p>Click on the image to add a hotspot</p>
                <div class="hotspot-form">
                    <input type="text" id="hotspot-title" placeholder="Hotspot Title" />
                    <textarea id="hotspot-description" placeholder="Hotspot Description"></textarea>
                    <div class="hotspot-linking">
                        <label for="hotspot-link-type">Link Type:</label>
                        <select id="hotspot-link-type">
                            <option value="info">Information Only</option>
                            <option value="image">Navigate to Image</option>
                        </select>
                        <div id="hotspot-target-image-container" style="display: none;">
                            <label>Select target image:</label>
                            <div id="image-preview-grid" class="image-preview-grid">
                                <!-- Image previews will be loaded here -->
                            </div>
                        </div>
                    </div>
                    <button id="save-hotspot" class="btn btn-primary">Save Hotspot</button>
                    <button id="cancel-hotspot" class="btn btn-secondary">Cancel</button>
                </div>
            </div>

            <!-- Photo Ordering -->
            <div id="photo-ordering" class="photo-ordering hidden">
                <h4>Photo Ordering</h4>
                <div class="photo-list">
                    <!-- Photos will be dynamically loaded here -->
                </div>
                <button id="save-order" class="btn btn-primary">Save Order</button>
            </div>
        </div>

        <!-- Hotspot Info Modal -->
        <div id="hotspot-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3 id="hotspot-modal-title"></h3>
                <p id="hotspot-modal-description"></p>
            </div>
        </div>

        <!-- Loading Screen -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p id="loading-text">Loading 360° image...</p>
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <div id="progress-text" class="progress-text">0%</div>
            </div>
            <div id="loading-details" class="loading-details"></div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
