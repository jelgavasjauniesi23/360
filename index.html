<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jauniešu centri</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script>
        // Wait for A-Frame to be ready before registering components
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof AFRAME !== 'undefined') {
                // Register cursor-listener component
                AFRAME.registerComponent('cursor-listener', {
                    init: function () {
                        this.el.addEventListener('click', function (evt) {
                            console.log('Hotspot clicked!');
                        });
                    }
                });
            }
        });
    </script>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <h1>Jauniešu centri</h1>
            <div class="controls">
                <button id="devModeBtn" class="btn btn-secondary">Dev Mode</button>
            </div>
        </header>

        <!-- Folder Navigation -->
        <nav class="folder-nav">
            <h3>Izvēlies jauniešu centru:</h3>
            <div class="folder-list">
                <button class="folder-btn active" data-folder="pakapiens">Pakāpiens</button>
                <button class="folder-btn" data-folder="pietura">Pietura</button>
                <button class="folder-btn" data-folder="spaktele">Špaktele</button>
            </div>
        </nav>

        <!-- Main Viewer -->
        <div id="viewer-container">
            <a-scene id="aframe-scene" 
                     vr-mode-ui="enabled: true" 
                     embedded 
                     style="height: 100%; width: 100%;"
                     background="color: #000"
                     controller-visibility
                     loading-screen="dotsColor: #667eea; backgroundColor: #000">
                     
                <!-- 360° Image Sphere -->
                <a-sky id="sky-sphere" 
                    radius="500" 
                    src="" 
                    rotation="0 -130 0"
                    data-raycastable>
                </a-sky>

                <!-- Camera with look controls -->
                <a-camera id="main-camera" 
                          look-controls="enabled: true; pointerLockEnabled: true;"
                          wasd-controls="enabled: false"
                          cursor="rayOrigin: mouse"
                          raycaster="objects: [data-raycastable]"
                          lock-camera-y>
                </a-camera>
                
                <!-- Controller entities with visible rays -->
                <a-entity id="left-controller" laser-controls="hand: left" raycaster="objects: [data-raycastable]; lineColor: #667eea; lineOpacity: 0.8; showLine: true" visible="false"></a-entity>
                <a-entity id="right-controller" laser-controls="hand: right" raycaster="objects: [data-raycastable]; lineColor: #667eea; lineOpacity: 0.8; showLine: true" visible="false"></a-entity>
                
                <!-- Exit fullscreen button for VR/AR mode -->
                <a-entity id="exit-fullscreen-button" 
                          geometry="primitive: plane; width: 0.5; height: 0.2" 
                          material="color: #ff4b4b; opacity: 0.9" 
                          text="value: Exit VR; align: center; color: white; width: 2"
                          position="0 -0.7 -1.5"
                          rotation="0 0 0"
                          scale="0.5 0.5 0.5"
                          visible="false"
                          data-raycastable
                          class="vr-ui-element">
                </a-entity>
                
            <!-- Hotspots will be added here dynamically -->
            <div id="hotspot-container"></div>
            
            <!-- Reticle for hotspot placement -->
            <div id="reticle" class="reticle hidden">
                <div class="reticle-crosshair">
                    <div class="reticle-line horizontal"></div>
                    <div class="reticle-line vertical"></div>
                    <div class="reticle-center"></div>
                </div>
            </div>
                
            </a-scene>
            
            <!-- Navigation Controls -->
            <div class="navigation-controls">
                <button id="prev-image" class="nav-btn prev-btn" title="Previous Image">‹</button>
                <button id="next-image" class="nav-btn next-btn" title="Next Image">›</button>
                <div class="image-counter">
                    <span id="current-image-num">1</span> / <span id="total-images">0</span>
                </div>
            </div>
            
            <!-- Dev Mode Controls -->
            <div id="dev-controls" class="dev-controls hidden">
                <h4>Dev Mode - Add Hotspots</h4>
                <p>Click on the image to add a hotspot</p>
                <div class="hotspot-form">
                    <div class="hotspot-linking">
                        <div id="hotspot-target-image-container" style="display: none;">
                            <label>Select target image:</label>
                            <div id="image-preview-grid" class="image-preview-grid">
                                <!-- Image previews will be loaded here -->
                            </div>
                        </div>
                    </div>
                    <button id="save-hotspot" class="btn btn-primary">Save Hotspot</button>
                    <button id="cancel-hotspot" class="btn btn-secondary">Cancel</button>
                    <button id="export-data" class="btn btn-secondary">Export Data</button>
                </div>
            </div>

            <!-- Photo Ordering -->
            <div id="photo-ordering" class="photo-ordering hidden">
                <h4>Photo Ordering</h4>
                <p>Drag and drop photos to reorder them</p>
                <div class="photo-list">
                    <!-- Photos will be dynamically loaded here -->
                </div>
                <div class="button-group">
                    <button id="save-order" class="btn btn-primary">Save Order</button>
                    <button id="cancel-order" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
            
            <!-- Hotspot Info Panel -->
            <div id="hotspot-info" class="hotspot-info hidden">
                <div class="hotspot-info-header">
                    <h4 id="hotspot-info-title">Hotspot Title</h4>
                    <button id="close-hotspot-info" class="close-btn">&times;</button>
                </div>
                <div id="hotspot-info-content" class="hotspot-info-content">
                    <!-- Hotspot content will be loaded here -->
                </div>
                <div class="button-group">
                    <button id="navigate-hotspot-btn" class="btn btn-primary">Navigate</button>
                </div>
            </div>

            <!-- Loading Screen -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p id="loading-text">Loading 360° image...</p>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                    <div id="progress-text" class="progress-text">0%</div>
                </div>
                <div id="loading-details" class="loading-details"></div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
